'''EQUIVALENCE: Search for Unicode strings by ASCII approximation.

   This is a poorman's POSIX "Equivalence Class" for Python. 
   It simulates the "[=x=]" notation of POSIX regular expressions
   which match all collating elements equivalent to "x".

   Given an ASCII string, equivalence() returns a regex of bracket
   expressions that matches "equivalent" Unicode characters.

     equivalence('en') -> '[eÃ¨Ä—ÃªÄ“Ã©EÃˆÄ–ÃŠÄ’Ã‰â€¦ğ™€ğ™šğ™´ğšğŸ„´ğŸ…”ğŸ…´][nÃ±NÃ‘â€¦ğ™‰ğ™£ğ™½ğš—ğŸ„½ğŸ…ğŸ…½]'.

   Usage:
       from equivalence import equivalence
       re.search( equivalence('epee'), words )
       # Matches 'Ã©pÃ©e' & 'Ã‰pÃ©e' (and also 'ï¼¥ï½ï½…ï½…', á¸œá¹—á»ƒá»‡, & 'ğ“”ğ“Ÿâ„°â…‡')
    
   Differences from POSIX regular expressions:
    * Fails to match Unicode Combining Characters.
    * Ignores the user's locale. The data is hardcoded to a sample
      taken in late 2025 of the POSIX 'en_US.UTF-8' locale.
    * Input must be ASCII.
    * Can be significantly slower.

   If equivalence() is too slow, use eqv(), which matches only the
   Latin-1 single byte character set instead of Unicode.

     eqv('en') -> '[EeÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«][NnÃ‘Ã±]'

   Usage for eqv():
       from equivalence import eqv
       re.search( eqv('epee'), words )       # matches 'Ã©pÃ©e' & 'Ã‰pÃ©e'

'''

_equivalence_table = {}
_equivalence_table['A']=_equivalence_table['a']="[AaÂªÃ€ÃÃ‚ÃƒÃ„Ã…Ã Ã¡Ã¢Ã£Ã¤Ã¥Ä€ÄÄ‚ÄƒÄ„Ä…ÇÇÇÇŸÇ Ç¡ÇºÇ»È€ÈÈ‚ÈƒÈ¦È§á´¬áµƒá¸€á¸áº áº¡áº¢áº£áº¤áº¥áº¦áº§áº¨áº©áºªáº«áº¬áº­áº®áº¯áº°áº±áº²áº³áº´áºµáº¶áº·â‚â„«â’œâ’¶â“êšê›ï¼¡ï½ğ€ğšğ´ğ‘ğ‘¨ğ’‚ğ’œğ’¶ğ“ğ“ªğ”„ğ”ğ”¸ğ•’ğ•¬ğ–†ğ– ğ–ºğ—”ğ—®ğ˜ˆğ˜¢ğ˜¼ğ™–ğ™°ğšŠğŸ„ğŸ„°ğŸ…ğŸ…°]"
_equivalence_table['B']=_equivalence_table['b']="[Bbá´®áµ‡á¸‚á¸ƒá¸„á¸…á¸†á¸‡â„¬â’â’·â“‘ï¼¢ï½‚ğğ›ğµğ‘ğ‘©ğ’ƒğ’·ğ“‘ğ“«ğ”…ğ”Ÿğ”¹ğ•“ğ•­ğ–‡ğ–¡ğ–»ğ—•ğ—¯ğ˜‰ğ˜£ğ˜½ğ™—ğ™±ğš‹ğŸ„‘ğŸ„±ğŸ…‘ğŸ…±]"
_equivalence_table['C']=_equivalence_table['c']="[CcÃ‡Ã§Ä†Ä‡ÄˆÄ‰ÄŠÄ‹ÄŒÄá¶œá¸ˆá¸‰â„‚â„ƒâ„­â…­â…½â’â’¸â“’ï¼£ï½ƒğ‚ğœğ¶ğ‘ğ‘ªğ’„ğ’ğ’¸ğ“’ğ“¬ğ” ğ•”ğ•®ğ–ˆğ–¢ğ–¼ğ—–ğ—°ğ˜Šğ˜¤ğ˜¾ğ™˜ğ™²ğšŒğŸ„’ğŸ„«ğŸ„²ğŸ…’ğŸ…²]"
_equivalence_table['D']=_equivalence_table['d']="[DdÃÃ°ÄÄÄÄ‘á´°áµˆá¶á¸Šá¸‹á¸Œá¸á¸á¸á¸á¸‘á¸’á¸“â……â…†â…®â…¾â’Ÿâ’¹â““ê¹êºï¼¤ï½„ğƒğğ·ğ‘‘ğ‘«ğ’…ğ’Ÿğ’¹ğ““ğ“­ğ”‡ğ”¡ğ”»ğ••ğ•¯ğ–‰ğ–£ğ–½ğ——ğ—±ğ˜‹ğ˜¥ğ˜¿ğ™™ğ™³ğšğŸ„“ğŸ„³ğŸ…“ğŸ…³ğŸ†¥]"
_equivalence_table['E']=_equivalence_table['e']="[EeÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«Ä’Ä“Ä”Ä•Ä–Ä—Ä˜Ä™ÄšÄ›È„È…È†È‡È¨È©á´±áµ‰á¸”á¸•á¸–á¸—á¸˜á¸™á¸šá¸›á¸œá¸áº¸áº¹áººáº»áº¼áº½áº¾áº¿á»€á»á»‚á»ƒá»„á»…á»†á»‡â‚‘â„¯â„°â…‡â’ â’ºâ“”ï¼¥ï½…ğ„ğğ¸ğ‘’ğ‘¬ğ’†ğ“”ğ“®ğ”ˆğ”¢ğ”¼ğ•–ğ•°ğ–Šğ–¤ğ–¾ğ—˜ğ—²ğ˜Œğ˜¦ğ™€ğ™šğ™´ğšğŸ„”ğŸ„´ğŸ…”ğŸ…´]"
_equivalence_table['F']=_equivalence_table['f']="[Ffá¶ á¸á¸Ÿâ„‰â„±â’¡â’»â“•ê»ê¼ï¼¦ï½†ğ…ğŸğ¹ğ‘“ğ‘­ğ’‡ğ’»ğ“•ğ“¯ğ”‰ğ”£ğ”½ğ•—ğ•±ğ–‹ğ–¥ğ–¿ğ—™ğ—³ğ˜ğ˜§ğ™ğ™›ğ™µğšğŸ„•ğŸ„µğŸ…•ğŸ…µ]"
_equivalence_table['G']=_equivalence_table['g']="[GgÄœÄÄÄŸÄ Ä¡Ä¢Ä£Ç¦Ç§Ç´Çµá´³áµáµ¹á¸ á¸¡â„Šâ’¢â’¼â“–ê½ê ê¡ï¼§ï½‡ğ†ğ ğºğ‘”ğ‘®ğ’ˆğ’¢ğ“–ğ“°ğ”Šğ”¤ğ”¾ğ•˜ğ•²ğ–Œğ–¦ğ—€ğ—šğ—´ğ˜ğ˜¨ğ™‚ğ™œğ™¶ğšğŸ„–ğŸ„¶ğŸ…–ğŸ…¶]"
_equivalence_table['H']=_equivalence_table['h']="[HhÄ¤Ä¥Ä¦Ä§ÈÈŸÊ°á´´á¸¢á¸£á¸¤á¸¥á¸¦á¸§á¸¨á¸©á¸ªá¸«áº–â‚•â„‹â„Œâ„â„â„â’£â’½â“—êŸ¸ï¼¨ï½ˆğ‡ğ¡ğ»ğ‘¯ğ’‰ğ’½ğ“—ğ“±ğ”¥ğ•™ğ•³ğ–ğ–§ğ—ğ—›ğ—µğ˜ğ˜©ğ™ƒğ™ğ™·ğš‘ğŸ„—ğŸ„·ğŸ…—ğŸ…·]"
_equivalence_table['I']=_equivalence_table['i']="[IiÃŒÃÃÃÃ¬Ã­Ã®Ã¯Ä¨Ä©ÄªÄ«Ä¬Ä­Ä®Ä¯Ä°ÇÇÈˆÈ‰ÈŠÈ‹á´µáµ¢á¸¬á¸­á¸®á¸¯á»ˆá»‰á»Šá»‹â±â„â„‘â„¹â…ˆâ… â…°â’¤â’¾â“˜ï¼©ï½‰ğˆğ¢ğ¼ğ‘–ğ‘°ğ’Šğ’¾ğ“˜ğ“²ğ”¦ğ•€ğ•šğ•´ğ–ğ–¨ğ—‚ğ—œğ—¶ğ˜ğ˜ªğ™„ğ™ğ™¸ğš’ğŸ„˜ğŸ„¸ğŸ…˜ğŸ…¸]"
_equivalence_table['J']=_equivalence_table['j']="[JjÄ´ÄµÇ°Ê²á´¶â…‰â’¥â’¿â“™â±¼ï¼ªï½Šğ‰ğ£ğ½ğ‘—ğ‘±ğ’‹ğ’¥ğ’¿ğ“™ğ“³ğ”ğ”§ğ•ğ•›ğ•µğ–ğ–©ğ—ƒğ—ğ—·ğ˜‘ğ˜«ğ™…ğ™Ÿğ™¹ğš“ğŸ„™ğŸ„¹ğŸ…™ğŸ…¹]"
_equivalence_table['K']=_equivalence_table['k']="[KkÄ¶Ä·Ç¨Ç©á´·áµá¸°á¸±á¸²á¸³á¸´á¸µâ‚–â„ªâ’¦â“€â“šê¢ê£ï¼«ï½‹ğŠğ¤ğ¾ğ‘˜ğ‘²ğ’Œğ’¦ğ“€ğ“šğ“´ğ”ğ”¨ğ•‚ğ•œğ•¶ğ–ğ–ªğ—„ğ—ğ—¸ğ˜’ğ˜¬ğ™†ğ™ ğ™ºğš”ğŸ„šğŸ„ºğŸ…šğŸ…º]"
_equivalence_table['L']=_equivalence_table['l']="[LlÄ¹ÄºÄ»Ä¼Ä½Ä¾Ä¿Å€ÅÅ‚Ë¡á´¸á¸¶á¸·á¸¸á¸¹á¸ºá¸»á¸¼á¸½â‚—â„’â„“â…¬â…¼â’§â“â“›ï¼¬ï½Œğ‹ğ¥ğ¿ğ‘™ğ‘³ğ’ğ“ğ“›ğ“µğ”ğ”©ğ•ƒğ•ğ•·ğ–‘ğ–«ğ—…ğ—Ÿğ—¹ğ˜“ğ˜­ğ™‡ğ™¡ğ™»ğš•ğŸ„›ğŸ„»ğŸ…›ğŸ…»]"
_equivalence_table['M']=_equivalence_table['m']="[Mmá´¹áµá¸¾á¸¿á¹€á¹á¹‚á¹ƒâ‚˜â„³â…¯â…¿â’¨â“‚â“œï¼­ï½ğŒğ¦ğ‘€ğ‘šğ‘´ğ’ğ“‚ğ“œğ“¶ğ”ğ”ªğ•„ğ•ğ•¸ğ–’ğ–¬ğ—†ğ— ğ—ºğ˜”ğ˜®ğ™ˆğ™¢ğ™¼ğš–ğŸ„œğŸ„¼ğŸ…œğŸ…¼]"
_equivalence_table['N']=_equivalence_table['n']="[NnÃ‘Ã±ÅƒÅ„Å…Å†Å‡ÅˆÇ¸Ç¹á´ºá¹„á¹…á¹†á¹‡á¹ˆá¹‰á¹Šá¹‹â¿â‚™â„•â’©â“ƒâ“ê¤ê¥ï¼®ï½ğğ§ğ‘ğ‘›ğ‘µğ’ğ’©ğ“ƒğ“ğ“·ğ”‘ğ”«ğ•Ÿğ•¹ğ–“ğ–­ğ—‡ğ—¡ğ—»ğ˜•ğ˜¯ğ™‰ğ™£ğ™½ğš—ğŸ„ğŸ„½ğŸ…ğŸ…½]"
_equivalence_table['O']=_equivalence_table['o']="[OoÂºÃ’Ã“Ã”Ã•Ã–Ã˜Ã²Ã³Ã´ÃµÃ¶Ã¸ÅŒÅÅÅÅÅ‘Æ Æ¡Ç‘Ç’ÇªÇ«Ç¬Ç­Ç¾Ç¿ÈŒÈÈÈÈªÈ«È¬È­È®È¯È°È±á´¼áµ’á¹Œá¹á¹á¹á¹á¹‘á¹’á¹“á»Œá»á»á»á»á»‘á»’á»“á»”á»•á»–á»—á»˜á»™á»šá»›á»œá»á»á»Ÿá» á»¡á»¢á»£â‚’â„´â’ªâ“„â“êœêï¼¯ï½ğğ¨ğ‘‚ğ‘œğ‘¶ğ’ğ’ªğ“ğ“¸ğ”’ğ”¬ğ•†ğ• ğ•ºğ–”ğ–®ğ—ˆğ—¢ğ—¼ğ˜–ğ˜°ğ™Šğ™¤ğ™¾ğš˜ğŸ„ğŸ„¾ğŸ…ğŸ…¾]"
_equivalence_table['P']=_equivalence_table['p']="[Ppá´¾áµ–á¹”á¹•á¹–á¹—â‚šâ„™â’«â“…â“Ÿï¼°ï½ğğ©ğ‘ƒğ‘ğ‘·ğ’‘ğ’«ğ“…ğ“Ÿğ“¹ğ”“ğ”­ğ•¡ğ•»ğ–•ğ–¯ğ—‰ğ—£ğ—½ğ˜—ğ˜±ğ™‹ğ™¥ğ™¿ğš™ğŸ„ŸğŸ„¿ğŸ…ŸğŸ…¿ğŸ†Š]"
_equivalence_table['Q']=_equivalence_table['q']="[Qqâ„šâ’¬â“†â“ ï¼±ï½‘ğğªğ‘„ğ‘ğ‘¸ğ’’ğ’¬ğ“†ğ“ ğ“ºğ””ğ”®ğ•¢ğ•¼ğ––ğ–°ğ—Šğ—¤ğ—¾ğ˜˜ğ˜²ğ™Œğ™¦ğš€ğššğŸ„ ğŸ…€ğŸ… ğŸ†€]"
_equivalence_table['R']=_equivalence_table['r']="[RrÅ”Å•Å–Å—Å˜Å™ÈÈ‘È’È“Ê³á´¿áµ£á¹˜á¹™á¹šá¹›á¹œá¹á¹á¹Ÿâ„›â„œâ„â’­â“‡â“¡ê‚êƒê¦ê§ï¼²ï½’ğ‘ğ«ğ‘…ğ‘Ÿğ‘¹ğ’“ğ“‡ğ“¡ğ“»ğ”¯ğ•£ğ•½ğ–—ğ–±ğ—‹ğ—¥ğ—¿ğ˜™ğ˜³ğ™ğ™§ğšğš›ğŸ„¡ğŸ„¬ğŸ…ğŸ…¡ğŸ†]"
_equivalence_table['S']=_equivalence_table['s']="[SsÅšÅ›ÅœÅÅÅŸÅ Å¡Å¿È˜È™Ë¢á¹ á¹¡á¹¢á¹£á¹¤á¹¥á¹¦á¹§á¹¨á¹©áº›â‚›â’®â“ˆâ“¢ê„ê…ê¨ê©ï¼³ï½“ğ’ğ¬ğ‘†ğ‘ ğ‘ºğ’”ğ’®ğ“ˆğ“¢ğ“¼ğ”–ğ”°ğ•Šğ•¤ğ•¾ğ–˜ğ–²ğ—Œğ—¦ğ˜€ğ˜šğ˜´ğ™ğ™¨ğš‚ğšœğŸ„¢ğŸ„ªğŸ…‚ğŸ…¢ğŸ†‚]"
_equivalence_table['T']=_equivalence_table['t']="[TtÅ¢Å£Å¤Å¥ÈšÈ›áµ€áµ—á¹ªá¹«á¹¬á¹­á¹®á¹¯á¹°á¹±áº—â‚œâ’¯â“‰â“£ê†ê‡ï¼´ï½”ğ“ğ­ğ‘‡ğ‘¡ğ‘»ğ’•ğ’¯ğ“‰ğ“£ğ“½ğ”—ğ”±ğ•‹ğ•¥ğ•¿ğ–™ğ–³ğ—ğ—§ğ˜ğ˜›ğ˜µğ™ğ™©ğšƒğšğŸ„£ğŸ…ƒğŸ…£ğŸ†ƒ]"
_equivalence_table['U']=_equivalence_table['u']="[UuÃ™ÃšÃ›ÃœÃ¹ÃºÃ»Ã¼Å¨Å©ÅªÅ«Å¬Å­Å®Å¯Å°Å±Å²Å³Æ¯Æ°Ç“Ç”Ç•Ç–Ç—Ç˜Ç™ÇšÇ›ÇœÈ”È•È–È—áµáµ˜áµ¤á¹²á¹³á¹´á¹µá¹¶á¹·á¹¸á¹¹á¹ºá¹»á»¤á»¥á»¦á»§á»¨á»©á»ªá»«á»¬á»­á»®á»¯á»°á»±â’°â“Šâ“¤êêŸï¼µï½•ğ”ğ®ğ‘ˆğ‘¢ğ‘¼ğ’–ğ’°ğ“Šğ“¤ğ“¾ğ”˜ğ”²ğ•Œğ•¦ğ–€ğ–šğ–´ğ—ğ—¨ğ˜‚ğ˜œğ˜¶ğ™ğ™ªğš„ğšğŸ„¤ğŸ…„ğŸ…¤ğŸ†„]"
_equivalence_table['V']=_equivalence_table['v']="[Vváµ›áµ¥á¹¼á¹½á¹¾á¹¿â…¤â…´â’±â“‹â“¥â±½ï¼¶ï½–ğ•ğ¯ğ‘‰ğ‘£ğ‘½ğ’—ğ’±ğ“‹ğ“¥ğ“¿ğ”™ğ”³ğ•ğ•§ğ–ğ–›ğ–µğ—ğ—©ğ˜ƒğ˜ğ˜·ğ™‘ğ™«ğš…ğšŸğŸ„¥ğŸ……ğŸ…¥ğŸ†…]"
_equivalence_table['W']=_equivalence_table['w']="[WwÅ´ÅµÊ·áµ‚áº€áºáº‚áºƒáº„áº…áº†áº‡áºˆáº‰áº˜â’²â“Œâ“¦ï¼·ï½—ğ–ğ°ğ‘Šğ‘¤ğ‘¾ğ’˜ğ’²ğ“Œğ“¦ğ”€ğ”šğ”´ğ•ğ•¨ğ–‚ğ–œğ–¶ğ—ğ—ªğ˜„ğ˜ğ˜¸ğ™’ğ™¬ğš†ğš ğŸ„¦ğŸ…†ğŸ…¦ğŸ††]"
_equivalence_table['X']=_equivalence_table['x']="[XxË£áºŠáº‹áºŒáºâ‚“â…©â…¹â’³â“â“§ï¼¸ï½˜ğ—ğ±ğ‘‹ğ‘¥ğ‘¿ğ’™ğ’³ğ“ğ“§ğ”ğ”›ğ”µğ•ğ•©ğ–ƒğ–ğ–·ğ—‘ğ—«ğ˜…ğ˜Ÿğ˜¹ğ™“ğ™­ğš‡ğš¡ğŸ„§ğŸ…‡ğŸ…§ğŸ†‡]"
_equivalence_table['Y']=_equivalence_table['y']="[YyÃÃ½Ã¿Å¶Å·Å¸È²È³Ê¸áºáºáº™á»²á»³á»´á»µá»¶á»·á»¸á»¹â’´â“â“¨ï¼¹ï½™ğ˜ğ²ğ‘Œğ‘¦ğ’€ğ’šğ’´ğ“ğ“¨ğ”‚ğ”œğ”¶ğ•ğ•ªğ–„ğ–ğ–¸ğ—’ğ—¬ğ˜†ğ˜ ğ˜ºğ™”ğ™®ğšˆğš¢ğŸ„¨ğŸ…ˆğŸ…¨ğŸ†ˆ]"
_equivalence_table['Z']=_equivalence_table['z']="[ZzÅ¹ÅºÅ»Å¼Å½Å¾á¶»áºáº‘áº’áº“áº”áº•â„¤â„¨â’µâ“â“©ï¼ºï½šğ™ğ³ğ‘ğ‘§ğ’ğ’›ğ’µğ“ğ“©ğ”ƒğ”·ğ•«ğ–…ğ–Ÿğ–¹ğ—“ğ—­ğ˜‡ğ˜¡ğ˜»ğ™•ğ™¯ğš‰ğš£ğŸ„©ğŸ…‰ğŸ…©ğŸ†‰]"


def equivalence(string: str):
    '''Given an ASCII string, return a regex that replaces each letter
    with a bracket expression matching "equivalent" Unicode characters.
    E.g., 'e' -> '[EeÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«Ä’Ä“Ä”Ä•Ä–Ä—Ä˜Ä™ÄšÄ›È„È…È†È‡È¨È©á´±áµ‰á¸”á¸•á¸–á¸—á¸˜á¸™á¸šá¸›á¸œá¸áº¸áº¹áººáº»áº¼áº½áº¾áº¿á»€á»á»‚á»ƒá»„á»…á»†á»‡â‚‘â„¯â„°â…‡â’ â’ºâ“”ï¼¥ï½…ğ„ğğ¸ğ‘’ğ‘¬ğ’†ğ“”ğ“®ğ”ˆğ”¢ğ”¼ğ•–ğ•°ğ–Šğ–¤ğ–¾ğ—˜ğ—²ğ˜Œğ˜¦ğ™€ğ™šğ™´ğšğŸ„”ğŸ„´ğŸ…”ğŸ…´]'    '''
    return ''.join([ _equivalence_table.get(k, k) for k in string ])


# Use eqv() for Latin-1 characters only (faster matching than Unicode)
_eqv_table={}
for i in _equivalence_table:
    _eqv_table[i] = ''.join( x for x in _equivalence_table[i] if ord(x)<256 )

def eqv(string: str):
    '''Given an ASCII string, return a regex that replaces each letter
    with a bracket expression matching "equivalent" Latin-1 characters.
    E.g., 'e' -> '[EeÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«]'    '''
    return ''.join([ _eqv_table.get(k, k) for k in string ])

